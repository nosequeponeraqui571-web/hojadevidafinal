{% load static %}
<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SYSTEM v7.0 | {{ perfil.nombres|default:"USUARIO" }}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        tron: {
                            bg: '#000000',
                            primary: 'var(--primary-color)', 
                            dim: 'rgba(var(--primary-rgb), 0.1)',
                            white: '#e0faff',
                            grey: '#23303a',
                        }
                    },
                    fontFamily: {
                        orbitron: ['Orbitron', 'sans-serif'],
                        rajdhani: ['Rajdhani', 'sans-serif'],
                    },
                    boxShadow: {
                        'neon': '0 0 5px var(--primary-color), 0 0 20px var(--primary-color)',
                        'hud': 'inset 0 0 20px rgba(var(--primary-rgb), 0.15)',
                    },
                    animation: {
                        'pulse-glow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    }
                }
            }
        }
    </script>

    <style>
        :root {
            --primary-color: #00f3ff;
            --primary-rgb: 0, 243, 255;
            --bg-color: #000000;
        }
        body.theme-ares {
            --primary-color: #ff003c;
            --primary-rgb: 255, 0, 60;
            --bg-color: #050002;
        }
        body {
            background-color: var(--bg-color);
            color: #e0faff;
            font-family: 'Rajdhani', sans-serif;
            overflow-x: hidden;
            transition: background-color 0.5s ease, color 0.5s ease;
            text-shadow: 0 0 4px rgba(var(--primary-rgb), 0.4);
        }
        h1, h2, h3, .font-orbitron, .text-tron-primary, .expand-text {
            text-shadow: 
                0 0 5px rgba(255, 255, 255, 0.8),
                0 0 15px var(--primary-color),
                0 0 25px rgba(var(--primary-rgb), 0.6);
        }
        .the-grid {
            position: fixed;
            top: 0; left: 0; width: 100vw; height: 100vh;
            background-image: 
                linear-gradient(rgba(var(--primary-rgb), 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(var(--primary-rgb), 0.1) 1px, transparent 1px);
            background-size: 50px 50px;
            background-position: center top;
            transform: perspective(500px) rotateX(60deg) translateY(-100px) scale(1.5);
            opacity: 0.6;
            z-index: -1;
            pointer-events: none;
            animation: moveGrid 20s linear infinite;
        }
        @keyframes moveGrid {
            0% { background-position: 0 0; }
            100% { background-position: 0 50px; }
        }
        .clip-tron {
            clip-path: polygon(10px 0, 100% 0, 100% calc(100% - 10px), calc(100% - 10px) 100%, 0 100%, 0 10px);
        }
        .sidebar-container {
            width: 4.5rem; 
            transition: width 0.4s cubic-bezier(0.25, 1, 0.5, 1);
            border-right: 1px solid rgba(var(--primary-rgb), 0.3);
        }
        .sidebar-container:hover { width: 18rem; }
        .expand-text {
            opacity: 0; max-width: 0; margin-left: 0; overflow: hidden;
            white-space: nowrap; display: inline-block; vertical-align: middle;
            transition: all 0.4s ease-in-out;
        }
        .sidebar-container:hover .expand-text { opacity: 1; max-width: 180px; margin-left: 0.75rem; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: var(--primary-color); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .label-tron {
            font-family: 'Orbitron', sans-serif; color: var(--primary-color); font-size: 0.7rem;
            letter-spacing: 1px; text-transform: uppercase; border-bottom: 1px solid rgba(var(--primary-rgb), 0.3);
            margin-bottom: 4px; display: inline-block; text-shadow: 0 0 8px var(--primary-color);
        }
        .value-tron { font-family: 'Rajdhani', sans-serif; color: #fff; font-size: 1rem; }
        .disc-ring { border-radius: 50%; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); box-sizing: border-box; }
        .ring-1 { width: 100%; height: 100%; border: 3px solid var(--primary-color); box-shadow: 0 0 15px var(--primary-color), inset 0 0 10px var(--primary-color); }
        .ring-2 { width: 88%; height: 88%; border: 1px dashed rgba(255, 255, 255, 0.5); animation: rotate-center-reverse 20s linear infinite; }
        .ring-3 { width: 112%; height: 112%; border-top: 2px solid transparent; border-right: 2px solid var(--primary-color); border-bottom: 2px solid transparent; border-left: 2px solid var(--primary-color); animation: rotate-center 6s linear infinite; opacity: 0.8; }
        .ring-4 { width: 130%; height: 130%; border: 1px solid var(--primary-color); opacity: 0.3; animation: rotate-center 12s linear infinite; }
        @keyframes rotate-center { 0% { transform: translate(-50%, -50%) rotate(0deg); } 100% { transform: translate(-50%, -50%) rotate(360deg); } }
        @keyframes rotate-center-reverse { 0% { transform: translate(-50%, -50%) rotate(0deg); } 100% { transform: translate(-50%, -50%) rotate(-360deg); } }
    </style>
</head>
<body id="main-body">

    <div class="the-grid"></div>

    <!-- MODAL PREVISUALIZADOR ADAPTATIVO -->
    <div id="preview-modal" class="fixed inset-0 z-[100] hidden flex items-center justify-center bg-black/90 backdrop-blur-sm p-4 md:p-8">
        <div id="modal-content" class="relative bg-black border border-tron-primary shadow-neon flex flex-col clip-tron transition-all duration-500 ease-in-out overflow-hidden w-full max-w-5xl h-[85vh]">
            <div class="flex justify-between items-center p-4 border-b border-tron-primary/30 bg-tron-primary/10 shrink-0">
                <div class="flex items-center gap-3">
                    <i class="fas fa-eye text-tron-primary animate-pulse-glow"></i>
                    <h3 class="text-tron-primary font-orbitron tracking-widest text-lg">VISOR DE DATOS</h3>
                </div>
                <button onclick="closePreview()" class="text-gray-400 hover:text-white hover:bg-tron-primary/20 w-8 h-8 flex items-center justify-center rounded-full transition border border-transparent hover:border-tron-primary">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="flex-1 p-0 bg-black/80 relative flex items-center justify-center overflow-hidden w-full h-full">
                <div id="preview-loader" class="absolute inset-0 flex items-center justify-center z-10 bg-black/50 backdrop-blur-sm">
                    <div class="flex flex-col items-center">
                        <div class="w-16 h-16 border-4 border-tron-primary border-t-transparent rounded-full animate-spin mb-4"></div>
                        <p class="text-tron-primary font-orbitron text-xs tracking-widest animate-pulse">CARGANDO RECURSO...</p>
                    </div>
                </div>
                <iframe id="preview-frame" class="hidden w-full h-full border-none relative z-20 bg-white"></iframe>
                <div id="image-container" class="hidden w-full h-full relative z-20 flex items-center justify-center overflow-auto p-2 bg-black/90">
                    <img id="preview-image" src="" class="max-w-full max-h-full object-contain shadow-2xl border border-tron-primary/20">
                </div>
            </div>
            <div class="p-2 border-t border-tron-primary/30 bg-black flex justify-end shrink-0 gap-2">
                 <a id="download-link" href="#" target="_blank" class="text-xs font-mono text-white flex items-center gap-2 px-4 py-2 bg-tron-primary/20 hover:bg-tron-primary hover:text-black transition border border-tron-primary clip-tron">
                    <i class="fas fa-external-link-alt"></i> ABRIR ORIGINAL
                </a>
            </div>
        </div>
    </div>

    <div class="flex flex-col md:flex-row min-h-screen">
        <aside class="sidebar-container bg-black/90 backdrop-blur-xl flex flex-col md:fixed md:h-screen z-50 overflow-x-hidden no-scrollbar group shadow-none transition-shadow duration-500 hover:shadow-neon">
            <div class="h-14 flex items-center justify-center border-b border-tron-primary/20 bg-gradient-to-r from-tron-primary/10 to-transparent overflow-hidden relative">
                <button onclick="toggleTheme()" class="w-full h-full flex items-center justify-center group/btn focus:outline-none">
                    <i id="theme-icon" class="fas fa-microchip text-tron-primary text-xl transition-all duration-500 group-hover/btn:rotate-180 group-hover/btn:scale-125 animate-pulse-glow"></i>
                </button>
            </div>
            <nav class="flex-1 px-1 md:px-2 py-4 space-y-3">
                {% if perfil.archivo_cv %}
                <div class="flex flex-col gap-1 mb-2 group/cv-container">
                    <button onclick="openPreview('{{ perfil.archivo_cv.url }}')" class="flex items-center px-3 py-3 clip-tron bg-tron-primary/10 border-l-4 border-tron-primary text-white hover:bg-tron-primary hover:text-black transition-all duration-300 shadow-hud overflow-hidden whitespace-nowrap w-full text-left">
                        <i class="fas fa-file-pdf text-lg min-w-[24px] text-center flex-shrink-0 text-tron-primary group-hover:text-black group-hover:animate-bounce"></i> 
                        <span class="font-bold expand-text uppercase tracking-widest font-orbitron text-sm">VER CV SUBIDO</span>
                    </button>
                </div>
                {% endif %}
                <div class="flex flex-col gap-1 mb-8 group/cv-gen">
                    <a href="{% url 'exportar_cv' %}" target="_blank" class="flex items-center px-3 py-3 clip-tron bg-white/5 border-l-4 border-white text-white hover:bg-white hover:text-black transition-all duration-300 shadow-hud overflow-hidden whitespace-nowrap w-full text-left">
                        <i class="fas fa-print text-lg min-w-[24px] text-center flex-shrink-0 text-white group-hover:text-black"></i> 
                        <span class="font-bold expand-text uppercase tracking-widest font-orbitron text-sm">GENERAR PDF</span>
                    </a>
                </div>
                <a href="#inicio" class="flex items-center px-3 py-2 rounded clip-tron hover:bg-tron-primary/10 border-l-2 border-transparent hover:border-tron-primary text-gray-300 hover:text-white transition-all overflow-hidden whitespace-nowrap">
                    <i class="fas fa-power-off text-lg min-w-[24px] text-center flex-shrink-0"></i> 
                    <span class="font-bold expand-text font-orbitron">INICIO</span>
                </a>
                <p class="expand-text text-[10px] text-tron-primary font-orbitron mt-6 mb-2 px-4 uppercase tracking-[0.2em] opacity-70">Sistema</p>
                <a href="#datos-personales" class="flex items-center px-3 py-2 text-gray-400 hover:text-tron-primary hover:bg-tron-primary/5 transition-all rounded overflow-hidden whitespace-nowrap group/link">
                    <i class="fas fa-id-card text-lg min-w-[24px] text-center group-hover/link:text-tron-primary flex-shrink-0"></i> 
                    <span class="font-rajdhani font-semibold text-lg expand-text">Datos Personales</span>
                </a>
                {% if experiencias %}
                <a href="#experiencia-laboral" class="flex items-center px-3 py-2 text-gray-400 hover:text-tron-primary hover:bg-tron-primary/5 transition-all rounded overflow-hidden whitespace-nowrap group/link">
                    <i class="fas fa-briefcase text-lg min-w-[24px] text-center group-hover/link:text-tron-primary flex-shrink-0"></i> 
                    <span class="font-rajdhani font-semibold text-lg expand-text">Experiencia Laboral</span>
                </a>
                {% endif %}
                {% if cursos %}
                <a href="#cursos-realizados" class="flex items-center px-3 py-2 text-gray-400 hover:text-tron-primary hover:bg-tron-primary/5 transition-all rounded overflow-hidden whitespace-nowrap group/link">
                    <i class="fas fa-graduation-cap text-lg min-w-[24px] text-center group-hover/link:text-tron-primary flex-shrink-0"></i> 
                    <span class="font-rajdhani font-semibold text-lg expand-text">Cursos Realizados</span>
                </a>
                {% endif %}
                {% if reconocimientos %}
                <a href="#reconocimientos" class="flex items-center px-3 py-2 text-gray-400 hover:text-tron-primary hover:bg-tron-primary/5 transition-all rounded overflow-hidden whitespace-nowrap group/link">
                    <i class="fas fa-medal text-lg min-w-[24px] text-center group-hover/link:text-tron-primary flex-shrink-0"></i> 
                    <span class="font-rajdhani font-semibold text-lg expand-text">Reconocimientos</span>
                </a>
                {% endif %}
                {% if productos_academicos %}
                <a href="#productos-academicos" class="flex items-center px-3 py-2 text-gray-400 hover:text-tron-primary hover:bg-tron-primary/5 transition-all rounded overflow-hidden whitespace-nowrap group/link">
                    <i class="fas fa-book text-lg min-w-[24px] text-center group-hover/link:text-tron-primary flex-shrink-0"></i> 
                    <span class="font-rajdhani font-semibold text-lg expand-text">Productos Académicos</span>
                </a>
                {% endif %}
                {% if productos_laborales %}
                <a href="#productos-laborales" class="flex items-center px-3 py-2 text-gray-400 hover:text-tron-primary hover:bg-tron-primary/5 transition-all rounded overflow-hidden whitespace-nowrap group/link">
                    <i class="fas fa-tools text-lg min-w-[24px] text-center group-hover/link:text-tron-primary flex-shrink-0"></i> 
                    <span class="font-rajdhani font-semibold text-lg expand-text">Productos Laborales</span>
                </a>
                {% endif %}
                {% if venta_garage %}
                <a href="#venta-garage" class="mt-6 flex items-center px-3 py-2 border border-white/20 text-white hover:bg-white hover:text-black transition-all clip-tron overflow-hidden whitespace-nowrap">
                    <i class="fas fa-shopping-cart text-lg min-w-[24px] text-center flex-shrink-0"></i> 
                    <span class="font-bold expand-text font-orbitron tracking-wider">Venta Garage</span>
                </a>
                {% endif %}
            </nav>
            <div class="p-4 border-t border-tron-primary/30 bg-black text-xs font-mono text-gray-300 overflow-hidden w-full">
                <p class="mb-2 text-tron-primary uppercase expand-text tracking-widest font-orbitron">Enlace:</p>
                <ul class="space-y-3">
                    <li class="flex items-center overflow-hidden">
                        <i class="fas fa-phone text-white text-lg min-w-[24px] text-center flex-shrink-0"></i> 
                        <span class="expand-text truncate pl-2 font-bold font-rajdhani text-sm text-gray-200">{{ perfil.telefonofijo|default:"" }}</span>
                    </li>
                    <li class="flex items-center overflow-hidden">
                        <i class="fas fa-envelope text-white text-lg min-w-[24px] text-center flex-shrink-0"></i> 
                        <span class="expand-text truncate pl-2 font-rajdhani text-sm text-gray-200">{{ perfil.numerocedula|default:"" }}</span>
                    </li>
                </ul>
            </div>
        </aside>

        <!-- CONTENIDO PRINCIPAL -->
        <main class="w-full md:ml-[4.5rem] p-6 md:p-12 relative z-10 transition-all duration-500">
            <!-- HERO SECTION -->
            <section id="inicio" class="min-h-screen flex flex-col justify-center mb-20 relative">
                <div class="mb-12 pl-4 md:pl-8 relative flex flex-col md:flex-row items-center gap-12 md:gap-16">
                    <div class="relative w-64 h-64 flex-shrink-0 group cursor-pointer flex justify-center items-center">
                        <div class="disc-ring ring-4"></div> <div class="disc-ring ring-3"></div>
                        <div class="disc-ring ring-1"></div> <div class="disc-ring ring-2"></div>
                        <div class="absolute inset-[2.5rem] rounded-full overflow-hidden border-2 border-tron-primary bg-black z-10 shadow-neon">
                            {% if perfil.fotoperfil %}
                                <img src="{{ perfil.fotoperfil.url }}" class="w-full h-full object-cover grayscale group-hover:grayscale-0 transition-all duration-700 opacity-90 group-hover:opacity-100 hover:scale-110 transform">
                            {% else %}
                                <div class="w-full h-full flex items-center justify-center bg-black text-tron-primary font-orbitron text-5xl animate-pulse">ID</div>
                            {% endif %}
                        </div>
                    </div>
                    <div class="text-center md:text-left border-l-0 md:border-l-8 border-tron-primary md:pl-10">
                        <h3 class="text-xl text-tron-primary font-orbitron mb-2 tracking-[0.4em] animate-pulse-glow">IDENTIDAD RECONOCIDA</h3>
                        <h1 class="text-6xl md:text-8xl font-black text-white uppercase mb-4 text-glow leading-tight font-orbitron">
                            {{ perfil.nombres|default:"" }} <br> 
                            <span class="text-transparent bg-clip-text bg-gradient-to-r from-tron-primary via-white to-white">{{ perfil.apellidos|default:"" }}</span>
                        </h1>
                        <p class="text-xl text-gray-300 font-rajdhani max-w-2xl border-t border-tron-primary/30 pt-6 mt-4">
                            {{ perfil.descripcionperfil|default:""|truncatewords:25 }}
                        </p>
                    </div>
                </div>
                <!-- Dashboard Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <div class="bg-black/60 border border-tron-primary/30 p-8 clip-tron relative group transition-all duration-300 border-glow backdrop-blur-sm">
                        <div class="absolute top-0 right-0 p-4 opacity-30 group-hover:opacity-100 transition"><i class="fas fa-id-card text-5xl text-tron-primary"></i></div>
                        <h3 class="text-2xl text-white font-bold mb-2 group-hover:text-tron-primary transition font-orbitron">DATOS PERSONALES</h3>
                        <a href="#datos-personales" class="inline-block px-6 py-2 border border-tron-primary text-tron-primary text-sm hover:bg-tron-primary hover:text-black transition uppercase font-bold tracking-widest clip-tron mt-4 font-orbitron">ACCEDER &gt;</a>
                    </div>
                    {% if experiencias %}
                    <div class="bg-black/60 border border-tron-primary/30 p-8 clip-tron relative group transition-all duration-300 border-glow backdrop-blur-sm">
                        <div class="absolute top-0 right-0 p-4 opacity-30 group-hover:opacity-100 transition"><i class="fas fa-briefcase text-5xl text-tron-primary"></i></div>
                        <h3 class="text-2xl text-white font-bold mb-2 group-hover:text-tron-primary transition font-orbitron">EXPERIENCIA LABORAL</h3>
                        <a href="#experiencia-laboral" class="inline-block px-6 py-2 border border-tron-primary text-tron-primary text-sm hover:bg-tron-primary hover:text-black transition uppercase font-bold tracking-widest clip-tron mt-4 font-orbitron">ACCEDER &gt;</a>
                    </div>
                    {% endif %}
                    {% if cursos %}
                    <div class="bg-black/60 border border-tron-primary/30 p-8 clip-tron relative group transition-all duration-300 border-glow backdrop-blur-sm">
                        <div class="absolute top-0 right-0 p-4 opacity-30 group-hover:opacity-100 transition"><i class="fas fa-graduation-cap text-5xl text-tron-primary"></i></div>
                        <h3 class="text-2xl text-white font-bold mb-2 group-hover:text-tron-primary transition font-orbitron">CURSOS REALIZADOS</h3>
                        <a href="#cursos-realizados" class="inline-block px-6 py-2 border border-tron-primary text-tron-primary text-sm hover:bg-tron-primary hover:text-black transition uppercase font-bold tracking-widest clip-tron mt-4 font-orbitron">ACCEDER &gt;</a>
                    </div>
                    {% endif %}
                    {% if reconocimientos %}
                    <div class="bg-black/60 border border-tron-primary/30 p-8 clip-tron relative group transition-all duration-300 border-glow backdrop-blur-sm">
                        <div class="absolute top-0 right-0 p-4 opacity-30 group-hover:opacity-100 transition"><i class="fas fa-medal text-5xl text-tron-primary"></i></div>
                        <h3 class="text-2xl text-white font-bold mb-2 group-hover:text-tron-primary transition font-orbitron">RECONOCIMIENTOS</h3>
                        <a href="#reconocimientos" class="inline-block px-6 py-2 border border-tron-primary text-tron-primary text-sm hover:bg-tron-primary hover:text-black transition uppercase font-bold tracking-widest clip-tron mt-4 font-orbitron">ACCEDER &gt;</a>
                    </div>
                    {% endif %}
                    {% if productos_academicos %}
                    <div class="bg-black/60 border border-tron-primary/30 p-8 clip-tron relative group transition-all duration-300 border-glow backdrop-blur-sm">
                        <div class="absolute top-0 right-0 p-4 opacity-30 group-hover:opacity-100 transition"><i class="fas fa-book text-5xl text-tron-primary"></i></div>
                        <h3 class="text-2xl text-white font-bold mb-2 group-hover:text-tron-primary transition font-orbitron">PRODUCTOS ACADÉMICOS</h3>
                        <a href="#productos-academicos" class="inline-block px-6 py-2 border border-tron-primary text-tron-primary text-sm hover:bg-tron-primary hover:text-black transition uppercase font-bold tracking-widest clip-tron mt-4 font-orbitron">ACCEDER &gt;</a>
                    </div>
                    {% endif %}
                    {% if productos_laborales %}
                    <div class="bg-black/60 border border-tron-primary/30 p-8 clip-tron relative group transition-all duration-300 border-glow backdrop-blur-sm">
                        <div class="absolute top-0 right-0 p-4 opacity-30 group-hover:opacity-100 transition"><i class="fas fa-tools text-5xl text-tron-primary"></i></div>
                        <h3 class="text-2xl text-white font-bold mb-2 group-hover:text-tron-primary transition font-orbitron">PRODUCTOS LABORALES</h3>
                        <a href="#productos-laborales" class="inline-block px-6 py-2 border border-tron-primary text-tron-primary text-sm hover:bg-tron-primary hover:text-black transition uppercase font-bold tracking-widest clip-tron mt-4 font-orbitron">ACCEDER &gt;</a>
                    </div>
                    {% endif %}
                    {% if venta_garage %}
                    <div class="bg-black/60 border border-tron-primary/30 p-8 clip-tron relative group transition-all duration-300 border-glow backdrop-blur-sm">
                        <div class="absolute top-0 right-0 p-4 opacity-30 group-hover:opacity-100 transition"><i class="fas fa-shopping-cart text-5xl text-tron-primary"></i></div>
                        <h3 class="text-2xl text-white font-bold mb-2 group-hover:text-tron-primary transition font-orbitron">VENTA GARAGE</h3>
                        <a href="#venta-garage" class="inline-block px-6 py-2 border border-tron-primary text-tron-primary text-sm hover:bg-tron-primary hover:text-black transition uppercase font-bold tracking-widest clip-tron mt-4 font-orbitron">ACCEDER &gt;</a>
                    </div>
                    {% endif %}
                </div>
            </section>

            <!-- 1. DATOS PERSONALES -->
            <section id="datos-personales" class="mb-32 pt-10 border-t border-tron-primary/20">
                <div class="flex items-center gap-4 mb-10">
                    <span class="text-tron-primary text-4xl shadow-neon rounded-full p-2"><i class="fas fa-id-card"></i></span>
                    <h2 class="text-4xl text-white uppercase font-orbitron tracking-widest">Datos Personales</h2>
                </div>
                <div class="bg-tron-panel border-l-4 border-tron-primary p-10 backdrop-blur-md shadow-hud relative overflow-hidden clip-tron">
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8">
                        <div class="p-4 bg-black border border-tron-primary/20 hover:border-tron-primary transition group">
                            <div class="label-tron">Cédula</div>
                            <div class="value-tron">{{ perfil.numerocedula|default:"" }}</div>
                        </div>
                        <div class="p-4 bg-black border border-tron-primary/20 hover:border-tron-primary transition group">
                            <div class="label-tron">Nacionalidad</div>
                            <div class="value-tron">{{ perfil.nacionalidad|default:"" }}</div>
                        </div>
                        <div class="p-4 bg-black border border-tron-primary/20 hover:border-tron-primary transition group">
                            <div class="label-tron">Estado Civil</div>
                            <div class="value-tron">{{ perfil.estadocivil|default:"" }}</div>
                        </div>
                        <div class="p-4 bg-black border border-tron-primary/20 hover:border-tron-primary transition group">
                            <div class="label-tron">Sexo</div>
                            <div class="value-tron">{{ perfil.get_sexo_display|default:"" }}</div>
                        </div>
                        <div class="p-4 bg-black border border-tron-primary/20 hover:border-tron-primary transition group">
                            <div class="label-tron">Lugar Nacimiento</div>
                            <div class="value-tron">{{ perfil.lugarnacimiento|default:"" }}</div>
                        </div>
                        <div class="p-4 bg-black border border-tron-primary/20 hover:border-tron-primary transition group">
                            <div class="label-tron">Fecha Nacimiento</div>
                            <div class="value-tron">{{ perfil.fechanacimiento|default:"" }}</div>
                        </div>
                        <div class="p-4 bg-black border border-tron-primary/20 hover:border-tron-primary transition group">
                            <div class="label-tron">Licencia</div>
                            <div class="value-tron">{{ perfil.licenciaconducir|default:"" }}</div>
                        </div>
                        <div class="p-4 bg-black border border-tron-primary/20 hover:border-tron-primary transition group col-span-2">
                            <div class="label-tron">Dirección Domicilio</div>
                            <div class="value-tron">{{ perfil.direcciondomiciliaria|default:"" }}</div>
                        </div>
                        <div class="p-4 bg-black border border-tron-primary/20 hover:border-tron-primary transition group col-span-2">
                            <div class="label-tron">Dirección Trabajo</div>
                            <div class="value-tron">{{ perfil.direcciontrabajo|default:"" }}</div>
                        </div>
                        <div class="p-4 bg-black border border-tron-primary/20 hover:border-tron-primary transition group col-span-2">
                            <div class="label-tron">Sitio Web</div>
                            <div class="value-tron">
                                {% if perfil.sitioweb %}
                                    <a href="{{ perfil.sitioweb }}" target="_blank" class="text-white hover:text-tron-primary underline">{{ perfil.sitioweb }}</a>
                                {% endif %}
                            </div>
                        </div>
                        <div class="p-4 bg-black border border-tron-primary/20 hover:border-tron-primary transition group col-span-2">
                            <div class="label-tron">Email Contacto</div>
                            <div class="value-tron">{{ perfil.email_contacto|default:"" }}</div>
                        </div>
                        {% if perfil.archivo_cv %}
                        <div class="col-span-full mt-4">
                            <button onclick="openPreview('{{ perfil.archivo_cv.url }}')" class="inline-flex items-center gap-2 text-sm text-black bg-tron-primary px-6 py-2 hover:bg-white hover:text-black transition uppercase font-bold tracking-widest clip-tron font-orbitron">
                                <i class="fas fa-eye"></i> Previsualizar CV
                            </button>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </section>

            <!-- 2. EXPERIENCIA LABORAL -->
            {% if experiencias %}
            <section id="experiencia-laboral" class="mb-32">
                <div class="flex items-center gap-4 mb-10">
                    <span class="text-white text-4xl shadow-neon-white rounded-full p-2"><i class="fas fa-briefcase"></i></span>
                    <h2 class="text-4xl text-white uppercase font-orbitron tracking-widest">Experiencia Laboral</h2>
                </div>
                <div class="space-y-12 relative ml-4 pl-10 border-l-2 border-tron-primary/30">
                    {% for exp in experiencias %}
                    <div class="relative group">
                        <div class="absolute -left-[49px] top-0 w-6 h-6 bg-black border-4 border-tron-primary rotate-45 group-hover:bg-tron-primary group-hover:scale-125 transition duration-300 shadow-neon"></div>
                        <div class="bg-black/80 border border-gray-800 p-8 hover:border-tron-primary transition duration-300 clip-tron relative">
                            <div class="flex flex-col md:flex-row justify-between items-start mb-6 border-b border-gray-800 pb-6">
                                <div>
                                    <h3 class="text-3xl text-white font-bold font-orbitron">{{ exp.cargodesempenado|default:"" }}</h3>
                                    <h4 class="text-tron-primary mt-2 text-lg font-bold tracking-wider uppercase font-orbitron">
                                        {{ exp.nombrempresa|default:"" }} <span class="text-gray-300 text-sm ml-2 normal-case font-rajdhani">// {{ exp.lugarempresa|default:"" }}</span>
                                    </h4>
                                </div>
                                <span class="text-xs font-mono text-white bg-tron-primary/20 border border-tron-primary px-4 py-2 mt-4 md:mt-0 tracking-widest">
                                    {{ exp.fechainiciogestion|date:"Y.m.d" }}  >>  {% if exp.fechafingestion %}{{ exp.fechafingestion|date:"Y.m.d" }}{% else %}ACTIVO{% endif %}
                                </span>
                            </div>
                            <p class="text-gray-200 font-rajdhani text-xl mb-8 leading-relaxed">{{ exp.descripcionfunciones|default:"" }}</p>
                            {% if exp.rutacertificado %}
                            <div class="mt-6 text-right">
                                <button onclick="openPreview('{{ exp.rutacertificado.url }}')" class="inline-flex items-center gap-2 text-xs text-white border border-white px-4 py-2 hover:bg-white hover:text-black transition uppercase font-bold tracking-widest clip-tron font-orbitron">
                                    <i class="fas fa-eye"></i> Ver Certificado
                                </button>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </section>
            {% endif %}

            <!-- 3. CURSOS REALIZADOS -->
            {% if cursos %}
            <section id="cursos-realizados" class="mb-32">
                <div class="flex items-center gap-4 mb-10">
                    <span class="text-tron-primary text-4xl shadow-neon rounded-full p-2"><i class="fas fa-graduation-cap"></i></span>
                    <h2 class="text-4xl text-white uppercase font-orbitron tracking-widest">Cursos Realizados</h2>
                </div>
                <div class="grid grid-cols-1 gap-8">
                    {% for curso in cursos %}
                    <div class="bg-tron-panel border-l-8 border-tron-primary p-8 shadow-lg hover:shadow-neon transition duration-300 relative group clip-tron">
                        <div class="flex flex-col md:flex-row justify-between mb-6">
                            <div>
                                <h3 class="text-2xl text-white font-bold mb-1 font-orbitron group-hover:text-tron-primary transition">{{ curso.nombrecurso|default:"" }}</h3>
                                <p class="text-gray-300 text-sm uppercase tracking-[0.2em] font-bold font-orbitron">{{ curso.entidadpatrocinadora|default:"" }}</p>
                            </div>
                            <div class="text-right mt-4 md:mt-0">
                                <span class="block text-tron-primary font-mono text-lg font-bold">{{ curso.totalhoras|default:"0" }} HRS</span>
                            </div>
                        </div>
                        <p class="text-gray-200 text-lg mb-6 border-b border-tron-primary/20 pb-6 font-rajdhani">{{ curso.descripcioncurso|default:"" }}</p>
                        {% if curso.rutacertificado %}
                        <div class="mt-6">
                            <button onclick="openPreview('{{ curso.rutacertificado.url }}')" class="w-full block text-center py-3 bg-tron-primary/10 border border-tron-primary text-tron-primary text-sm hover:bg-tron-primary hover:text-black transition uppercase font-bold tracking-widest clip-tron font-orbitron">
                                <i class="fas fa-eye mr-2"></i> Visualizar Diploma
                            </button>
                        </div>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
            </section>
            {% endif %}

            <!-- 4. RECONOCIMIENTOS -->
            {% if reconocimientos %}
            <section id="reconocimientos" class="mb-32">
                <div class="flex items-center gap-4 mb-10">
                    <span class="text-white text-4xl shadow-neon-white rounded-full p-2"><i class="fas fa-star"></i></span>
                    <h2 class="text-4xl text-white uppercase font-orbitron tracking-widest">Reconocimientos</h2>
                </div>
                <div class="grid gap-8">
                    {% for rec in reconocimientos %}
                    <div class="border-l-4 border-white p-8 flex flex-col md:flex-row gap-8 items-center bg-black/40 hover:bg-white/5 transition duration-500 shadow-neon-white clip-tron">
                        <div class="text-6xl text-white opacity-80"><i class="fas fa-trophy"></i></div>
                        <div class="flex-1 w-full text-center md:text-left">
                            <h3 class="text-2xl text-white font-bold font-orbitron">{{ rec.tiporeconocimiento|default:"" }}</h3>
                            <p class="text-tron-primary text-sm font-mono mb-4 uppercase tracking-widest">{{ rec.entidadpatrocinadora|default:"" }} // {{ rec.fechareconocimiento|date:"Y" }}</p>
                            {% if rec.rutacertificado %}
                            <div>
                                <button onclick="openPreview('{{ rec.rutacertificado.url }}')" class="text-white hover:text-tron-primary underline decoration-tron-primary underline-offset-4 text-sm font-bold uppercase tracking-widest font-orbitron">
                                    <i class="fas fa-eye"></i> Ver Documento
                                </button>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </section>
            {% endif %}

            <!-- 5. PRODUCTOS ACADÉMICOS - MODIFICADO "FULL BLEED" -->
            {% if productos_academicos %}
            <section id="productos-academicos" class="mb-32">
                <div class="flex items-center gap-4 mb-10">
                    <span class="text-tron-primary text-4xl shadow-neon-cyan rounded-full p-2"><i class="fas fa-book"></i></span>
                    <h2 class="text-4xl text-white uppercase font-orbitron tracking-widest">Productos Académicos</h2>
                </div>
                <div class="grid md:grid-cols-2 gap-8">
                    {% for prod in productos_academicos %}
                    <div class="bg-tron-panel border border-white/20 hover:border-white transition-all duration-300 shadow-neon-white clip-tron h-full flex flex-col group p-0">
                        <!-- IMAGEN FULL BLEED -->
                        {% if prod.imagen_producto %}
                        <div class="w-full h-64 overflow-hidden border-b border-white/10 relative bg-black/50">
                            <!-- Overlay al hacer hover -->
                            <div class="absolute inset-0 z-20 flex items-center justify-center bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity duration-300 cursor-pointer" onclick="openPreview('{{ prod.imagen_producto.url }}')">
                                <span class="text-white font-orbitron tracking-widest border border-white px-4 py-2 hover:bg-white hover:text-black transition">
                                    <i class="fas fa-expand me-2"></i> AMPLIAR
                                </span>
                            </div>
                            <!-- Imagen ajustada -->
                            <img src="{{ prod.imagen_producto.url }}" alt="{{ prod.nombrerecurso }}" class="w-full h-full object-cover object-top opacity-90 group-hover:scale-110 transition-transform duration-700">
                        </div>
                        {% endif %}
                        
                        <!-- CONTENIDO CON PADDING -->
                        <div class="p-6 flex flex-col flex-grow">
                            <div class="flex justify-between items-start mb-2">
                                <h4 class="font-bold text-white text-xl font-orbitron">{{ prod.nombrerecurso|default:"" }}</h4>
                                <i class="fas fa-scroll text-white text-xl"></i>
                            </div>
                            <span class="inline-block bg-white/10 text-white text-[10px] px-2 py-1 mt-1 mb-4 uppercase font-orbitron self-start">{{ prod.clasificador|default:"" }}</span>
                            <p class="text-gray-200 text-sm border-t border-white/10 pt-4 font-rajdhani flex-grow">{{ prod.descripcion|default:"" }}</p>
                            
                            <!-- BOTÓN VISUALIZAR -->
                            {% if prod.imagen_producto %}
                            <div class="mt-6">
                                <button onclick="openPreview('{{ prod.imagen_producto.url }}')" class="w-full block text-center py-3 bg-white/5 border border-white text-white text-sm hover:bg-white hover:text-black transition uppercase font-bold tracking-widest clip-tron font-orbitron">
                                    <i class="fas fa-eye mr-2"></i> Visualizar Recurso
                                </button>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </section>
            {% endif %}

            <!-- 6. PRODUCTOS LABORALES -->
            {% if productos_laborales %}
            <section id="productos-laborales" class="mb-32">
                <div class="flex items-center gap-4 mb-10">
                    <span class="text-white text-4xl shadow-neon-white rounded-full p-2"><i class="fas fa-tools"></i></span>
                    <h2 class="text-4xl text-white uppercase font-orbitron tracking-widest">Productos Laborales</h2>
                </div>
                <div class="grid md:grid-cols-2 gap-8">
                    {% for prod in productos_laborales %}
                    <div class="p-6 bg-tron-panel border border-tron-primary/30 hover:border-tron-primary transition-all duration-300 shadow-neon clip-tron h-full flex flex-col">
                        <div class="flex justify-between items-start mb-2">
                            <h4 class="font-bold text-white text-xl font-orbitron">{{ prod.nombreproducto|default:"" }}</h4>
                            <i class="fas fa-cogs text-tron-primary text-xl"></i>
                        </div>
                        <span class="inline-block text-tron-primary text-[10px] border border-tron-primary/50 px-2 py-1 mt-1 mb-4 font-mono self-start">{{ prod.fechaproducto|date:"Y.m.d" }}</span>
                        <p class="text-gray-200 text-sm border-t border-tron-primary/20 pt-4 font-rajdhani flex-grow">{{ prod.descripcion|default:"" }}</p>
                        {% if prod.url_proyecto %}
                        <div class="mt-4 text-right">
                             <a href="{{ prod.url_proyecto }}" target="_blank" class="text-white hover:text-tron-primary font-orbitron text-xs tracking-widest border-b border-white/20 hover:border-tron-primary">VER PROYECTO ></a>
                        </div>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
            </section>
            {% endif %}

            <!-- 7. VENTA GARAGE -->
            {% if venta_garage %}
            <section id="venta-garage" class="mb-20 pt-10 border-t-4 border-double border-gray-800">
                <div class="flex justify-between items-center mb-10">
                    <div class="flex items-center gap-4">
                        <span class="text-white text-4xl animate-pulse"><i class="fas fa-shopping-cart"></i></span>
                        <h2 class="text-4xl text-white font-orbitron uppercase tracking-widest">Venta Garage</h2>
                    </div>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
                    {% for item in venta_garage %}
                    <div class="bg-black border border-white/20 relative overflow-hidden group hover:border-tron-primary hover:shadow-neon transition duration-500 clip-tron h-full flex flex-col">
                        <div class="h-48 bg-gray-900 flex items-center justify-center border-b border-gray-800 relative">
                            {% if item.foto_producto %}
                                <img src="{{ item.foto_producto.url }}" class="w-full h-full object-cover opacity-70 group-hover:opacity-100 transition duration-500">
                            {% else %}
                                <i class="fas fa-cube text-6xl text-gray-700 group-hover:text-tron-primary transition duration-500"></i>
                            {% endif %}
                            <div class="absolute top-0 right-0 bg-white text-black px-3 py-1 text-xs font-bold uppercase font-orbitron">
                                {{ item.estadoproducto|default:"Stock" }}
                            </div>
                        </div>
                        <div class="p-6 relative z-10 flex-grow flex flex-col">
                            <h3 class="font-bold text-2xl text-white mb-2 truncate font-orbitron">{{ item.nombreproducto|default:"Item" }}</h3>
                            <p class="text-sm text-gray-300 line-clamp-2 mb-6 h-10 font-rajdhani flex-grow">{{ item.descripcion|default:"..." }}</p>
                            <div class="flex justify-between items-center pt-4 border-t border-gray-800 mt-auto">
                                <span class="text-3xl font-black text-tron-primary font-mono">${{ item.valordelbien|floatformat:0 }}</span>
                                <button onclick="navigator.clipboard.writeText('{{ item.idperfilconqueestaactivo.email_contacto }}').then(() => alert('Email de contacto copiado al portapapeles'))" class="text-black bg-white px-4 py-2 text-xs font-bold uppercase hover:bg-tron-primary transition clip-tron font-orbitron">
                                    CONTACTAR
                                </button>
                            </div>
                            {% if item.documento_interes %}
                            <div class="mt-2 text-center">
                                <a href="{{ item.documento_interes.url }}" target="_blank" class="text-xs text-gray-500 hover:text-white font-mono">Ver Ficha Técnica</a>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </section>
            {% endif %}

            <!-- Footer -->
            <footer class="text-center text-gray-600 text-xs font-mono mt-20 pt-10 border-t border-gray-900 mb-10">
                <p class="mb-2 tracking-[0.5em] font-orbitron">END OF LINE</p>
                <p class="font-rajdhani">&copy; {% now "Y" %} {{ perfil.nombres|default:"USUARIO" }} {{ perfil.apellidos|default:"DESCONOCIDO" }}. SISTEMA v7.0 SECURE.</p>
            </footer>

        </main>
    </div>

    <!-- Script del Previsualizador y Toggle de Tema -->
    <script>
        function toggleTheme() {
            const body = document.getElementById('main-body');
            const icon = document.getElementById('theme-icon');
            
            body.classList.toggle('theme-ares');
            
            if(body.classList.contains('theme-ares')) {
                localStorage.setItem('cv-theme', 'ares');
                icon.style.transform = 'rotate(180deg)';
                icon.style.color = '#ff003c';
            } else {
                localStorage.setItem('cv-theme', 'legacy');
                icon.style.transform = 'rotate(0deg)';
                icon.style.color = '#00f3ff';
            }
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            console.log("%c VERSIÓN V7 - ESTILO DE TARJETAS CORREGIDO ", "background: #00f3ff; color: #000000; font-size: 20px; font-weight: bold;");
            if(localStorage.getItem('cv-theme') === 'ares') toggleTheme(); 
            
            const modal = document.getElementById('preview-modal');
            if (modal) {
                modal.addEventListener('click', function(e) { 
                    if (e.target === this) closePreview(); 
                });
            }
            
            const closeBtn = document.querySelector('#preview-modal button');
            if(closeBtn) {
               closeBtn.addEventListener('click', closePreview);
            }
        });

        function openPreview(url) {
            console.log("Intentando abrir previsualización para:", url);
            
            const modal = document.getElementById('preview-modal');
            const frame = document.getElementById('preview-frame');
            const imgContainer = document.getElementById('image-container');
            const img = document.getElementById('preview-image');
            const loader = document.getElementById('preview-loader');
            const downloadLink = document.getElementById('download-link');
            
            if (!modal) return;

            // Resetear estado visual
            modal.classList.remove('hidden');
            if(loader) loader.classList.remove('hidden');
            if(frame) frame.classList.add('hidden');
            if(imgContainer) imgContainer.classList.add('hidden');
            if(frame) frame.src = '';
            if(img) img.src = '';
            if(downloadLink) downloadLink.href = url;

            // --- LÓGICA DE DETECCIÓN ---
            const isPDF = url.toLowerCase().includes('.pdf');
            const hasImageExtension = url.match(/\.(jpeg|jpg|gif|png|webp|bmp)$/i);
            const looksLikeImage = hasImageExtension || (url.includes('image/upload') && !isPDF);

            if (looksLikeImage) {
                console.log("Parece una IMAGEN, intentando cargar...");
                if(img) {
                    img.src = url;
                    
                    img.onload = () => { 
                        console.log("Imagen cargada correctamente");
                        if(loader) loader.classList.add('hidden'); 
                        if(imgContainer) imgContainer.classList.remove('hidden'); 
                    };
                    
                    img.onerror = () => { 
                        console.warn("Fallo al cargar como imagen. Cambiando a modo Documento...");
                        img.src = '';
                        img.removeAttribute('src');
                        loadAsDocument(url, frame, loader);
                    };
                }
            } else {
                loadAsDocument(url, frame, loader);
            }
        }

        function loadAsDocument(url, frame, loader) {
            console.log("Cargando como Documento (PDF/Proxy)...");
            
            const imgContainer = document.getElementById('image-container');
            if(imgContainer) imgContainer.classList.add('hidden'); 
            
            const timestamp = new Date().getTime();
            const proxyUrl = `/ver-archivo/?url=${encodeURIComponent(url)}&t=${timestamp}`;
            
            if(frame) {
                frame.src = proxyUrl;
                
                setTimeout(() => {
                    console.log("Forzando visualización del iframe (Timeout)");
                    if(loader) loader.classList.add('hidden');
                    frame.classList.remove('hidden');
                }, 1500); 
                
                frame.onload = () => {
                    console.log("Documento cargado en iframe (onload)");
                    if(loader) loader.classList.add('hidden');
                    frame.classList.remove('hidden');
                };
            }
        }

        function closePreview() {
            const modal = document.getElementById('preview-modal');
            const frame = document.getElementById('preview-frame');
            const img = document.getElementById('preview-image');
            
            if(modal) modal.classList.add('hidden');
            if(frame) frame.src = '';
            if(img) {
                img.src = '';
                img.removeAttribute('src'); 
            }
        }
        
        document.addEventListener('keydown', function(event) { if (event.key === "Escape") closePreview(); });
    </script>
</body>
</html>